<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" href="https://www.resources.aau.dk/design2013/images/aaufavicon.ico?v=2" type="image/x-icon">
    <title>PhD Theses from Aalborg University</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.1/nouislider.min.css">
    
    <style>

body {
    overflow-x: hidden; /* Disable horizontal scrolling */
    width: 100%;
    max-width: 100vw;
    font-family: 'Barlow', sans-serif;
    background-color: #211a52;
    color: white;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    box-sizing: border-box; /* Include padding and border in the element's total width/height */
/* Slider container adjustments */
.slider-container {
    width: 100%;
    max-width: 500px;
    margin: 20px auto;
    text-align: center;
}

/* Slider track */
.noUi-target {
    width: 100%;
    background-color: #e0e0e0; /* Light gray track */
    border-radius: 14px; /* Rounded track */
    height: 18px; /* Increase track height slightly */
    position: relative;
    margin: 0 auto;
    overflow: hidden; /* Ensure handles don't overflow */
}

/* Selected range fill */
.noUi-connect {
    background-color: #00aaff; /* Blue fill */
    border-radius: 14px;
    height: 18px; /* Match the height of the track */
}

/* Slider handles */
.noUi-handle {
    background-color: #ffffff;  /* White handle */
    border-radius: 50%;  /* Circular handle */
    width: 18px;  /* Handle size reduced */
    height: 18px;  /* Match handle height exactly with track */
    border: 2px solid #00aaff;  /* Blue border */
    cursor: pointer;
    position: absolute;
    top: 0px;  /* Align exactly with the track */
    z-index: 10;  /* Ensure the handle is on top */
    overflow: hidden; /* Prevent overflow */
}

/* Hover effect for handle */
.noUi-handle:hover {
    background-color: #00aaff; /* Handle turns blue on hover */
    border-color: #ffffff;
}

/* Tooltip styles for the slider */
.noUi-tooltip {
    background-color: #211a52;  /* Dark background for tooltips */
    color: white;
    border-radius: 5px;
    padding: 5px;
    font-size: 0.75rem;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

/* Labels below the slider */
.slider-labels {
    font-size: 14px;
    color: #ffffff;
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
    padding: 0 10px;
}

/* Card container to ensure all cards stretch equally */
.card-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;  /* Space cards evenly */
    gap: 20px;  /* Space between the cards */
}

/* Style for each card */
.card {
    display: flex;
    flex-direction: column;
    justify-content: space-between;  /* Ensure space between text and button */
    padding: 20px;
    border-radius: 8px;
    background-color: #2C4991; /* Adjust to card color */
    color: white;
    height: 100%;  /* Ensure full height of each card */
    min-height: 350px;  /* Set a minimum height to keep cards equal */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    align-items: stretch;  /* Ensure consistent stretch of content */
}

/* Bold styling for Author, Year, and Series */
.card p span {
    font-weight: bold;
}

/* Increase space between the last text and the Read More button */
.card p:last-child {
    margin-bottom: 30px;  /* Ensure enough space between text and button */
}

/* Read More button styling */
.read-more-btn {
    background-color: #00ccff;
    color: white;
    font-size: 16px;
    padding: 12px 12px;
    border: none;
    border-radius: 8px;
    text-align: center;
    text-decoration: none;
    cursor: pointer;
    margin-top: auto;  /* Push the button to the bottom */
    transition: background-color 0.3s ease, transform 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);  /* Shadow for the button */
    align-self: center; /* Keep button centered */
}

/* Hover effect for the button */
.read-more-btn:hover {
    background-color: #0099cc;
    transform: translateY(-3px);
}

/* Active/Pressed effect */
.read-more-btn:active {
    background-color: #007fa3;
    transform: translateY(1px);
}

/* For Thesis Info Bold */
.thesis-info span {
    font-weight: bold;
}


/* Header Styles */
header {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    background-color: #211a52;
    width: calc(100% - 270px); /* Take up remaining width on desktop */
    margin-left: 270px;
    box-sizing: border-box;
}

header img {
    max-width: 250px;
    height: auto;
    margin-bottom: 10px;
}

.header-text {
    font-size: 3rem;
    font-weight: bold;
    text-align: center;
}

/* Responsive Header for Mobile */
@media (max-width: 768px) {
    header {
        width: 100%; /* Full width on mobile */
        margin-left: 0;
        padding: 10px 20px;
    }

    .header-text {
        font-size: 2rem;
    }

    header img {
        max-width: 200px;
    }
}

/* Sidebar Styles */
.sidebar {
    width: 250px;
    background-color: #211a52;
    padding: 20px;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    color: white;
    z-index: 2;
    overflow-y: auto;
    border-right: 1px solid white;
    box-sizing: border-box;
}

@media (max-width: 768px) {
    .sidebar {
        width: 100%;
        position: relative;
        border-right: none;
        border-bottom: 1px solid white;
        margin-bottom: 20px;
    }
}

/* Content Styles */
.content {
    margin-left: 270px;
    padding: 20px;
    flex-grow: 1;
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* Center content on both desktop and mobile */
    transition: margin-left 0.3s;
    box-sizing: border-box;
}

@media (max-width: 768px) {
    .content {
        margin-left: 0;
    }
}

/* Slider Container */
.range-slider {
    width: 100%;
    max-width: 90%; /* Prevent overflow on mobile */
    margin: 0 auto;
}

/* Ensure no unwanted scrolling when interacting with slider */
.noUi-handle {
    touch-action: none;
    pointer-events: all;
}

.noUi-base {
    overflow: hidden;
}

/* Search Bar */
.search-bar-wrapper {
    display: flex;
    justify-content: center;
    width: 100%;
}

.search-bar {
    width: 100%;
    padding: 12px 15px;
    border-radius: 25px;
    border: 1px solid #ddd;
    font-size: 1rem;
    color: #333;
    background-color: #f9f9f9;
    outline: none;
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.search-bar:hover, .search-bar:focus {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    border-color: #007bff;
}

/* Series Filter */
#series-filter {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    color: #333;
    font-size: 1rem;
    width: 100%;
    outline: none;
    margin-bottom: 20px;
}

#series-filter:focus {
    border-color: #007bff;
    background-color: #fff;
}

/* Reset Filters Button */
#reset-filters {
    background-color: #bb5b17;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
}

#reset-filters:hover {
    background-color: #0056b3;
}

/* Thesis Cards Styling */
.thesis-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    padding: 20px;
}

.thesis-card {
    background-color: #ffffff22;
    color: white;
    border: 1px solid white;
    border-radius: 10px;
    padding: 20px;
    margin: 15px;
    width: 100%;
    max-width: 300px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
}

/* Hover effect on thesis cards */
.thesis-card:hover {
    transform: scale(1.05);
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
}

/* Restore Series Colors */
.ssh-card {
    background: linear-gradient(135deg, rgba(36, 65, 141, 0.5), rgba(36, 65, 141, 0.4)) !important;
    color: #FFFFFF !important;
    transition: background 0.3s ease;
}

.tech-card {
    background: linear-gradient(135deg, rgba(25, 46, 109, 0.5), rgba(25, 46, 109, 0.4)) !important;
    color: #FFFFFF !important;
    transition: background 0.3s ease;
}

.eng-card {
    background: linear-gradient(135deg, rgba(88, 89, 91, 0.5), rgba(88, 89, 91, 0.4)) !important;
    color: #FFFFFF !important;
    transition: background 0.3s ease;
}

.health-card {
    background: linear-gradient(135deg, rgba(184, 31, 36, 0.5), rgba(184, 31, 36, 0.4)) !important;
    color: #FFFFFF !important;
    transition: background 0.3s ease;
}

.other-card, .no-series-card {
    background: linear-gradient(135deg, rgba(0, 127, 163, 0.5), rgba(0, 127, 163, 0.4)) !important;
    color: #FFFFFF !important;
    transition: background 0.3s ease;
}

/* Hover effect on series cards */
.ssh-card:hover {
    background: linear-gradient(135deg, rgba(36, 65, 141, 0.9), rgba(36, 65, 141, 0.8)) !important;
}

.tech-card:hover {
    background: linear-gradient(135deg, rgba(25, 46, 109, 0.9), rgba(25, 46, 109, 0.8)) !important;
}

.eng-card:hover {
    background: linear-gradient(135deg, rgba(88, 89, 91, 0.9), rgba(88, 89, 91, 0.8)) !important;
}

.health-card:hover {
    background: linear-gradient(135deg, rgba(184, 31, 36, 0.9), rgba(184, 31, 36, 0.8)) !important;
}

.other-card:hover, .no-series-card:hover {
    background: linear-gradient(135deg, rgba(0, 127, 163, 0.9), rgba(0, 127, 163, 0.8)) !important;
}

.explore-themes-btn {
    text-align: center;
    margin-top: 50px;
}

.explore-link {
    display: inline-block;
    padding: 10px 20px;
    background-color: #007FA3;  /* Button background color */
    color: white;
    font-size: 1rem;
    text-decoration: none;
    border-radius: 5px;
    transition: background-color 0.3s;
}

.explore-link:hover {
    background-color: #005f7a;  /* Darker shade on hover */
}


/* Mobile Adjustments */
@media (max-width: 768px) {
    .thesis-list {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
    }

    .thesis-card {
        width: 100% !important;
        max-width: 90% !important;
        margin-bottom: 20px !important;
    }
}

.new-badge {
    background-color: #0E8563;  /* Green background */
    color: #FFFFFF;  /* White text */
    font-size: 12px;
    font-weight: bold;
    padding: 6px 12px;  /* Slightly larger padding */
    border-radius: 20px;  /* More rounded */
    margin-right: 10px;
    display: inline-block;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);  /* Soft shadow */
    text-transform: uppercase;  /* Optional: Makes text all caps */
}



    </style>
</head>
<body>
  <header>
     <div class="header-text" style="font-size: 3.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);">
        PhD Theses from Aalborg University
    </div>
    <div id="thesis-counter" style="font-size: 2rem; margin-top: 10px; font-weight: bold; color: #cc445b;">
    </div>
<canvas id="thesis-bar-chart" width="600" height="300" style="display: block; margin: 20px auto;"></canvas>
<style>
    #thesis-bar-chart {
        display: block;
        margin: 20px auto; /* Center the chart and add margin */
    }
</style>
<div id="site-description" style="
    text-align: center;
    max-width: 800px;
    margin: 20px auto;
    padding: 15px;
    color: #DDDDDD;
    font-size: 1.2rem;
    line-height: 1.6;
">
    <p style="font-weight: 400;">
        <strong style="font-size: 1.3rem; color: #FFFFFF;">Explore the collection of Open Access PhD Theses</strong> 
        from Aalborg University. <br>Browse by 
        <span style="color: #FFFFFF; font-weight: bold;">year</span>, 
        <span style="color: #FFFFFF; font-weight: bold;">series</span>, or 
        search by <span style="color: #FFFFFF; font-weight: bold;">title and author</span>.
    </p>
    <p style="
        font-size: 1rem;
        font-weight: 300;
        color: #BBBBBB;
        margin-top: 15px;
    ">
        Contact us for any inquiries: 
        <a href="mailto:aauopen@aau.dk" 
            style="color: #008BB2; font-weight: bold; text-decoration: none;">
            aauopen@aau.dk
        </a>
    </p>
</div>


</header>

    <!-- Sidebar for filters -->
<div class="sidebar">
    <!-- Hero Logo with link -->
    <a href="https://www.en.aau.dk/research/open-publishing" target="_blank">
        <img src="OPEN_LEFT_WHITE.png" alt="Hero Logo" style="max-width: 100%; height: auto;">
    </a>

    <br><br><br>
    <div class="search-bar-wrapper">
        <input type="text" id="search-bar" class="search-bar" placeholder="Search by title or author" oninput="applyFilters()">
    </div>
    <br>
    <br>
    <div class="slider-container">
        <label for="year-range"></label>
        <div id="year-slider" class="range-slider"></div>
        <div class="slider-labels">
            <span id="min-year">1984</span>
            <span id="max-year">2025</span>
        </div>
    </div>
    <div class="series-container">
        <label for="series-filter">Filter by series:</label>
        <select id="series-filter" onchange="applyFilters()">
            <option value="">All Series</option>
            <option value="SSH">SSH</option>
            <option value="ENG">ENG</option>
            <option value="HEALTH">HEALTH</option>
            <option value="TECH">TECH</option>
            <option value="Other">Other</option>
        </select>
    </div>
    <button id="reset-filters" onclick="resetFilters()">Reset Filters</button>

  <!-- Explore our other themes button -->
    <div class="explore-themes-btn">
        <a href="https://vbn.aau.dk/themes/" target="_blank" class="explore-link">Explore our other themes</a>
    </div>
</div>

</div>


    <section class="content">
        <div id="sorting-indicator" style="
    text-align: center;
    font-size: 1rem;
    color: #BBBBBB;
    margin-bottom: 15px;
">
    Sorted by <strong>Most Recently Added</strong>
</div>

        <div class="thesis-list" id="thesis-list">
            <!-- Thesis cards will be injected here by JavaScript -->
        </div>
    </section>

    <!-- Include PapaParse and noUiSlider libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.1/nouislider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    
    <script>
        let itemsPerBatch = 20; // Number of theses loaded at once in endless scroll
        let currentPage = 1;
        let thesisData = [];
        let filteredData = [];
        let minYear, maxYear;
        let yearRange = [1984, 2025]; // Default year range (adjust based on your dataset)
        let selectedSeries = ''; // Default to all series
        let barChartInstance = null;  // To store the bar chart instance


        // Series Mapping Object (based on your provided data)
        const seriesMapping = {
    "": "Other", // Empty series maps to "Other"
    "D : Institut for Elektroniske Systemer. Afdeling for Proceskontrol, Aalborg Universitet": "Other",
    "Fracture and Dynamics": "Other",
    "I 14 94 S 0076 : Institut for Energiteknik": "Other",
    "I 14 95 S 0077 : Institut for Energiteknik": "Other",
    "I 14 95 S 0078 : Institut for Energiteknik, Aalborg Universitet": "Other",
    "Industrial Ph.D. Project": "Other",
    "ISP-Skriftserie": "Other",
    "Ph.D. dissertation series": "Other",
    "Ph.D. Report Series": "Other",
    "Ph.D. Thesis, RISC Group": "Other",
    "Ph.d.-serien for Det Humanistiske Fakultet, Aalborg Universitet": "SSH",
    "Ph.d.-serien for Det Humanistiske og Samfundsvidenskabelige fakultet, Aalborg Universitet": "SSH",
    "Ph.d.-serien for Det Ingeniør- og Naturvidenskabelige Fakultet, Aalborg Universitet": "ENG",
    "Ph.d.-serien for Det Samfundsvidenskabelige Fakultet, Aalborg Universitet": "SSH",
    "Ph.d.-serien for Det Sundhedsvidenskabelige Fakultet, Aalborg Universitet": "HEALTH",
    "Ph.d.-serien for Det Teknisk-Naturvidenskabelige Fakultet, Aalborg Universitet": "ENG",
    "Ph.d.-serien for Det Tekniske Fakultet for IT og Design, Aalborg Universitet": "TECH",
    "Ph.D.dissertation series : Environmental Engineering Laboratory, Aalborg University": "Other",
    "PhD Series, Faculty of Engineering and Science, Aalborg University": "ENG",
    "PhD Series, Technical Faculty of IT and Design, Aalborg University": "TECH",
    "PhD Series, The Doctoral School of Social Sciences and Humanities, Aalborg University": "SSH",
    "Publication : Department of Computer Science, The Faculty of Engineering and Science, Aalborg University": "Other",
    "Publication : Department of Computer Science, Aalborg University": "Other",
    "Publikationer fra Institut for Sprog og International Kulturstudier": "Other",
    "R : Department of Computer Science, Aalborg University": "Other",
    "R : Institut for Bygningsteknik, Aalborg Universitet": "Other",
    "R : Institut for Elektroniske Systemer, Aalborg Universitet": "Other",
    "R : Institute of Electronic Systems, Aalborg University": "Other",
    "R : Institute of Electronic Systems, AAU": "Other",
    "R / Inst. for Bygningsteknik, Aalborg Universitetscenter": "Other",
    "R.": "Other",
    "Series paper": "Other",
    "Special Report": "Other",
    "Special Report : Institut for Maskinteknik": "Other",
    "Special Report : Institute of Mechanical Engineering": "Other",
    "Special report / Institute of Mechanical Engineering": "Other",
    "Spirit PhD Series": "Other",
    "Structural Reliability Theory": "Other",
    "TNP-Serien": "Other",
    "Aalborg Universitet. Det Humanistiske Fakultet. Ph.D.-Serien": "SSH",
    "Aalborg Universitet. Det Samfundsvidenskabelige Fakultet. Ph.D.-Serien": "SSH",
    "Aalborg Universitet. Det Sundhedsvidenskabelige Fakultet. Ph.D.-Serien": "HEALTH",
    "Aalborg Universitetscenter. Institut for Elektroniske Systemer. Afdeling for Kommunikationsteknologi. Rapport": "Other",
    "AAU Geotechnical Engineering Papers": "Other"
};

function createBarChart(data) {
    const ctx = document.getElementById('thesis-bar-chart').getContext('2d');

    // Find the min and max years in the filtered data
    const years = data.map(thesis => parseInt(thesis.year, 10)).filter(year => !isNaN(year));
    const minYear = Math.min(...years);
    const maxYear = Math.max(...years);

    // Initialize the data structure to count theses per year and series
    const thesisPerYearAndSeries = {};
    for (let year = minYear; year <= maxYear; year++) {
        thesisPerYearAndSeries[year] = {
            SSH: 0,
            TECH: 0,
            ENG: 0,
            HEALTH: 0,
            Other: 0,
            'No series': 0
        };
    }

    // Count theses per year and series from the filtered data
    data.forEach(thesis => {
        const year = parseInt(thesis.year, 10);
        if (!isNaN(year) && thesisPerYearAndSeries.hasOwnProperty(year)) {
            const series = thesis.series || 'No series';  // Default to 'No series'
            thesisPerYearAndSeries[year][series]++;
        }
    });

    // Filter out years where all series values are zero (no data for the year)
    const filteredYears = Object.keys(thesisPerYearAndSeries).filter(year => {
        const seriesValues = Object.values(thesisPerYearAndSeries[year]);
        return seriesValues.some(count => count > 0);  // Only keep years where there's data
    });

    // Prepare series keys and colors
    const seriesKeys = ['SSH', 'TECH', 'ENG', 'HEALTH', 'Other'];
    const seriesColors = {
        'SSH': '#2C4991',
        'TECH': '#1F3471',
        'ENG': '#535254',
        'HEALTH': '#A22226',
        'Other': '#007FA3',
        'No series': '#007FA3'
    };

    // Create datasets with filtered years
    const datasets = seriesKeys.map(series => ({
        label: series,
        data: filteredYears.map(year => thesisPerYearAndSeries[year][series]),
        backgroundColor: seriesColors[series],
        borderColor: seriesColors[series],
        borderWidth: 1
    }));

    // If barChartInstance exists, update it with new data
    if (barChartInstance) {
        barChartInstance.data.labels = filteredYears;  // Update labels (filtered years)
        barChartInstance.data.datasets = datasets;  // Update datasets (series counts)
        barChartInstance.update();  // Update the chart
    } else {
        // Otherwise, create a new stacked bar chart instance
        barChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: filteredYears,  // Filtered years as labels
                datasets: datasets  // Datasets for each series
            },
            options: {
                scales: {
                    x: {
                        stacked: true  // Enable stacking on the x-axis (for series)
                    },
                    y: {
                        beginAtZero: true,
                        stacked: true,  // Enable stacking on the y-axis
                        ticks: {
                            stepSize: 1,  // Ensure the step between ticks is always 1
                            callback: function(value) {
                                if (value % 1 === 0) {
                                    return value;  // Only display whole numbers
                                }
                            }
                        }
                    }
                }
            }
        });
    }
}




function loadTheses() {
    // Read the XLSX file
    fetch('theses.xlsx')
        .then(response => response.arrayBuffer())
        .then(data => {
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];

            // Convert the sheet data into JSON format
            thesisData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

            // Assume the first row is the header and skip it
            thesisData = thesisData.slice(1).map(row => {
                return {
                    title: row[0] || 'Unknown Title',
                    author: row[1] || 'Unknown Author',
                    year: row[2] || 'Unknown Year',
                    series: row[3] || 'Other',
                    url: row[4] || '#',
                    created: row[5] ? new Date(row[5]) : null  // Extract 'Created Date'
                };
            });

            // Sort first by Created Date (newest first), then by Year (newest first), then Title
            thesisData = thesisData.sort((a, b) => {
                if (b.created && a.created) {
                    return b.created - a.created; // Sort by Created Date
                } else if (b.created) {
                    return 1; // Push undefined Created Dates down
                } else if (a.created) {
                    return -1;
                }
                const yearDiff = (parseInt(b.year, 10) || 0) - (parseInt(a.year, 10) || 0);
                if (yearDiff !== 0) {
                    return yearDiff;
                }
                return a.title.localeCompare(b.title);
            });

            // Mark the 20 most recent theses as "New"
            thesisData.forEach((thesis, index) => {
                thesis.isNew = index < 25; // First 20 get the "New" badge
            });

            // Handle the series mapping
            thesisData = thesisData.map(thesis => {
                thesis.series = seriesMapping[thesis.series ? thesis.series.trim() : ""] || "Other";
                return thesis;
            });

            const years = thesisData.map(thesis => parseInt(thesis.year, 10)).filter(year => !isNaN(year));
            minYear = Math.min(...years);
            maxYear = Math.max(...years);
            yearRange = [minYear, maxYear];

            setupYearSlider(minYear, maxYear);  // Set up the slider with the correct range
            applyFilters();  // Apply filters immediately after loading the data
            setupInfiniteScroll();  // Setup the endless scroll

            // Delay the loading of the bar chart by 2 seconds
            setTimeout(() => {
                createBarChart(thesisData); // Call the bar chart function after the delay
            }, 10);
        })
        .catch(error => console.log("Error loading XLSX file:", error));
}



function updateCounter(count) {
    const counterElement = document.getElementById("thesis-counter");
    let currentCount = 0;

    // Clear any previous intervals
    if (window.counterInterval) {
        clearInterval(window.counterInterval);
    }

    if (count === 0) {
        counterElement.textContent = "0 Theses"; // Handle 0 case directly
        return;
    }

    // Calculate an increment value to count faster for large numbers
    let incrementValue = Math.max(1, Math.ceil(count / 10));  // Adjust this based on the total count


    window.counterInterval = setInterval(() => {
        currentCount += incrementValue;
        if (currentCount >= count) {
            currentCount = count;  // Ensure it doesn’t exceed the actual count
            clearInterval(window.counterInterval); // Stop the interval when done
        }
        counterElement.textContent = `${currentCount} Theses`;
    }, 30);  // Adjust this for faster or slower display
}

        // Set up the slider for filtering by year range
        function setupYearSlider(minYear, maxYear) {
            const slider = document.getElementById('year-slider');

            noUiSlider.create(slider, {
                start: [minYear, maxYear], // Initial year range
                connect: true,
                range: {
                    'min': minYear,
                    'max': maxYear
                },
                step: 1,
                tooltips: [true, true],
                format: {
                    to: value => Math.round(value),
                    from: value => Math.round(value)
                }
            });

            // Update the year range when the slider is adjusted
            slider.noUiSlider.on('update', function (values, handle) {
                yearRange = values.map(value => Math.round(value)); // Update the year range
                document.getElementById('min-year').innerText = yearRange[0];
                document.getElementById('max-year').innerText = yearRange[1];
                applyFilters(); // Reapply the filters based on new year range
            });
        }

        // Apply search and filter by year range and series
      function applyFilters() {
    const selectedSeries = document.getElementById("series-filter").value;
    const searchQuery = document.getElementById("search-bar").value.toLowerCase();

    filteredData = thesisData.filter(thesis => {
        const thesisYear = parseInt(thesis.year, 10) || 0;
        const matchesYear = thesisYear >= yearRange[0] && thesisYear <= yearRange[1];
        const matchesSeries = !selectedSeries || thesis.series === selectedSeries;
        const matchesSearch = thesis.title.toLowerCase().includes(searchQuery) || thesis.author.toLowerCase().includes(searchQuery);

        return matchesYear && matchesSeries && matchesSearch;
    });

    currentPage = 1;
    document.getElementById("thesis-list").innerHTML = "";  // Clear previous content
    displayTheses(itemsPerBatch);  // Display the filtered theses

    // Update the counter with the filtered number of theses
    updateCounter(filteredData.length);

    // Update the bar chart with filtered data
    createBarChart(filteredData);  // Now the chart will update dynamically
}



        // Display a batch of theses with color-coded cards
       function displayTheses(batchSize) {
    const thesisList = document.getElementById("thesis-list");

    const start = (currentPage - 1) * batchSize;
    const end = start + batchSize;
    const pageData = filteredData.slice(start, end);

    pageData.forEach(thesis => {
        const thesisCard = document.createElement("div");

        // Extract the UUID from the 'url' column in your CSV data
        const uuid = thesis.url ? thesis.url.split('/').pop() : '#';  
        const thesisUrl = `https://vbn.aau.dk/en/publications/${uuid}`;  

        // Map series to the correct class
        let seriesClass = '';
        switch (thesis.series) {
            case 'SSH': seriesClass = 'ssh-card'; break;
            case 'TECH': seriesClass = 'tech-card'; break;
            case 'ENG': seriesClass = 'eng-card'; break;
            case 'HEALTH': seriesClass = 'health-card'; break;
            case 'Other': seriesClass = 'other-card'; break;
            case 'No series': seriesClass = 'no-series-card'; break;
            default: seriesClass = 'other-card';
        }

        // Add "New" badge if thesis is marked as new
        const newBadge = thesis.isNew ? `<span class="new-badge">New</span>` : "";

        thesisCard.className = `thesis-card ${seriesClass}`;
        thesisCard.innerHTML = `
            <div class="thesis-header">
                ${newBadge} <span class="thesis-title">${thesis.title || 'No Title Available'}</span>
            </div>
            <div class="thesis-info"><span>Author:</span> ${thesis.author || 'Unknown'}</div>
            <div class="thesis-info"><span>Year:</span> ${thesis.year || 'Unknown'}</div>
            <div class="thesis-info"><span>Series:</span> ${thesis.series || 'Unknown'}</div>
            <br>
            <a href="${thesisUrl}" target="_blank" class="read-more-btn">Read More</a>
        `;

        thesisList.appendChild(thesisCard);
    });
}




        // Setup infinite scroll to load more cards when scrolling
        function setupInfiniteScroll() {
    window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
            currentPage++;
            displayTheses(itemsPerBatch);
        }
    });
}


        // Reset filters
        function resetFilters() {
            document.getElementById("series-filter").value = ''; // Clear series filter
            document.getElementById("year-slider").noUiSlider.set([minYear, maxYear]); // Reset year range properly
            document.getElementById("search-bar").value = ''; // Clear search bar
            applyFilters(); // Reapply the filters
        }

        // Load the theses data and set up the filters when the page loads
        window.onload = function () {
            loadTheses(); // Load theses from CSV
        };
    </script>
</body>
</html>
